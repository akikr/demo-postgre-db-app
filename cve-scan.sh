#!/usr/bin/env sh
if [ "$1" ]; then
	docker volume create tmp-data > /dev/null
	sleep 1
	echo "Started scanning image: "$1
	docker run --pull=always --rm -it -v /var/run/docker.sock:/var/run/docker.sock -v tmp-data:/tmp --name syft anchore/syft:latest $1 -o spdx-json=/tmp/sbom.json
	sleep 1
	docker run --pull=always --rm -it -v /var/run/docker.sock:/var/run/docker.sock -v tmp-data:/tmp --name grype anchore/grype:latest sbom:/tmp/sbom.json -o table --file /tmp/cves.table
	docker run --rm -i -v tmp-data:/tmp alpine:latest cat /tmp/cves.table
	docker volume rm tmp-data > /dev/null
else
  echo "No image name provided !!"
fi
